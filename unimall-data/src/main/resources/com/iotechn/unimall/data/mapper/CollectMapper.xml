<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.iotechn.unimall.data.mapper.CollectMapper">

    <resultMap type="com.iotechn.unimall.data.dto.CollectDTO" id="CollectDTOMap">
        <id column="c_id" property="id"/>
        <result column="c_userId" property="userId"/>
        <result column="c_gmtCreate" property="gmtCreate"/>
        <result column="c_gmtUpdate" property="gmtUpdate"/>
        <result column="s_id" property="spuDO.id"/>
        <result column="s_original_price" property="spuDO.originalPrice"/>
        <result column="s_price" property="spuDO.price"/>
        <result column="s_vip_price" property="spuDO.vipPrice"/>
        <result column="s_title" property="spuDO.title"/>
        <result column="s_sales" property="spuDO.sales"/>
        <result column="s_img" property="spuDO.img"/>
        <result column="s_description" property="spuDO.description"/>
        <result column="s_unit" property="spuDO.unit"/>
        <result column="s_status" property="spuDO.status"/>
        <result column="s_gmt_update" property="spuDO.gmtUpdate"/>
        <result column="s_gmt_create" property="spuDO.gmtCreate"/>
    </resultMap>

    <select id="countCollect" resultType="java.lang.Integer">
        select count(1)
        from unimall_collect
        where user_id = #{userId}
    </select>

    <select id="getCollectAll" resultMap="CollectDTOMap">
     SELECT
            c.id as c_id,
            c.user_id as c_userId,
            c.gmt_create as c_gmtCreate,
            c.gmt_update as c_gmtUpdate,
            s.id as s_id,
            s.original_price as s_original_price,
            s.price as s_price,
            s.vip_price as s_vip_price,
            s.title as s_title,
            s.sales as s_sales,
            s.img as s_img,
            s.description as s_description,
            s.unit as s_unit,
            s.status as s_status,
            s.gmt_update as s_gmt_update,
            s.gmt_create as s_gmt_create
    from
            unimall_collect as c,
            unimall_spu as s
    where
            c.user_id = #{userId}
            and c.spu_id = s.id
    limit
            #{offset},#{size}
    </select>

    <select id="getCollectById" resultMap="CollectDTOMap">
     SELECT
            c.id as c_id,
            c.user_id as c_userId,
            c.gmt_create as c_gmtCreate,
            c.gmt_update as c_gmtUpdate,
            s.id as s_id,
            s.original_price as s_original_price,
            s.price as s_price,
            s.vip_price as s_vip_price,
            s.title as s_title,
            s.sales as s_sales,
            s.img as s_img,
            s.description as s_description,
            s.unit as s_unit,
            s.status as s_status,
            s.gmt_update as s_gmt_update,
            s.gmt_create as s_gmt_create
    from
            unimall_collect as c,
            unimall_spu as s
    where
            c.user_id = #{userId}
            and c.spu_id = s.id
            and c.id = #{collectId}
            <if test="spuId != null">
                and c.spu_id = #{spuId}
            </if>
    </select>

    <select id="getUserCollectSpuIds" resultType="java.lang.String">
      SELECT spu_id FROM  unimall_collect WHERE user_id = #{userId}
    </select>

</mapper>